<html>
  <head>
    <title>Joke Client</title>
    <link href="default-styles.css" type="text/css" rel="stylesheet" />
    <style>
      header{
        background-color:pink;
        color: yellow;
        font-size:2em;
        padding:1em;
      }
      
      h1{
        font-family: fantasy;
        filter: drop-shadow(5px 5px 2px #4444dd);
      }
      
      section{
        border-bottom:1px dashed gray;
      }
    </style>
    <script>
        
        	"use strict"; // because I got rid of client-side babel
    const parseJSON = (xhr, content) => {
    	if(xhr.response && xhr.getResponseHeader('Content-Type') === 'application/json'){
      	const obj = JSON.parse(xhr.response);
      	console.dir(obj);
      	
      	if(obj.message){
      		content.innerHTML += `<p>${obj.message}</p>`;
      	}
      }
    };    
     
      const teams = [];
      
      
      const viewTeam = () =>{
          document.querySelector("#content").innerHTML = " ";
          let check = 0;
          const namePokemon = document.querySelector("#name").value;
          const attackPokemon = document.querySelector("#attack").value;
          let formData = { "name": namePokemon, "attack": attackPokemon};
          for(let i = 0; i< teams.length; i++){
              if(teams[i].name === formData.name){
                  check++;
              }
          }
          if(!namePokemon||!attackPokemon){
              document.querySelector("#content").innerHTML = `<p>Empty Fields</p>`;
          }else if(check > 0){
              document.querySelector("#content").innerHTML = `<p>Cannot repeat Pokemon</p>`;
          }else{
          teams.push(formData);
            document.querySelector("#team").innerHTML = teams;   
          }
                    
      }
      
      const removePokemon = () => {
          delete teams[team.indexOf(document.querySelector("#name").value)];
          document.querySelector("#team").innerHTML = teams.attack;
      }
      
      const handleResponse = (xhr) => {
     	
      const content = document.querySelector('#content');
       //check the status code
      switch(xhr.status) {
        case 200: //success
          content.innerHTML = `<b>Success</b>`;
          break;
        case 201: //created
          content.innerHTML = '<b>Create</b>';
          break;
        case 204: //updated (no response back from server)
          content.innerHTML = '<b>Updated (No Content)</b>';
          return;
        case 400: //bad request
          content.innerHTML = `<b>Bad Request</b>`;
          break;
        default: //any other status code
          content.innerHTML = `Error code not implemented by client.`;
          break;
      }
       //parse response 
      parseJSON(xhr, content);
      
      
    };

      const saveTeam = (e,nameForm) => {          
          
          e.preventDefault();
          const nameAction = nameForm.getAttribute("action");
          const nameMethod = nameForm.getAttribute("method");
			
          const xhr = new XMLHttpRequest();
          xhr.open(nameMethod,nameAction);
          xhr.setRequestHeader('Accept','application/json');
          xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
          xhr.onload = () => handleResponse(xhr);
          xhr.send(JSON.stringify(teams));
          teams = [];
          return false;
          
          
      }
      
   
      const init = () => {
          
         // An Event *Handler*
        // document.querySelector("#btnJoke").onclick = downloadJoke; // same as below, less typing, use which ever version you prefer
      
        
      
          document.querySelector("#addButton").addEventListener("click",viewTeam);
        // **Actually, event handlers and listeners are NOT exactly the same in all use cases - what ARE the differences?**
          document.querySelector("#deleteButton").addEventListener("click",removePokemon);
          
          
          
          const nameForm = document.querySelector('#nameForm');
          const addTeam = (e) => saveTeam(e, nameForm);
          nameForm.addEventListener('submit', addTeam);
          //document.querySelector("#save").addEventListener("click",saveTeam);
      }
      
      window.onload = init;
     
    </script>
  </head>
  <body>
    <header>
      <h1>Are you ready to LAUGH?</h1>
    </header>
    
   
    <section>
        <h2>Search your favorite Pokemon</h2>
        <form id="nameForm" action="/adduser" method="post">
        <h2>Add Pokemon</h2>
        <p>Name:<input id="name"></p>
        <p>Attack:<input id="attack"></p>
        <p><button type="button" id = "addButton">Add</button></p>
        <p><button type="button" id="deleteButton">Delete</button></p>
        <p><button type="submit">Save Team</button></p>
        <a href="/getTeams">/getTeams</a>
        </form>
        
        
        
      </section>
      <div id="team"></div>
    <section id="content">
        
    </section>
  </body>
</html>